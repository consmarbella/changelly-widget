<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprar Cripto - DolarExpress</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: white; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); max-width: 500px; width: 100%; padding: 32px; }
        h1 { color: #1e3c72; margin-bottom: 24px; text-align: center; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; color: #333; }
        select, input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        select:focus, input:focus { outline: none; border-color: #2a5298; }
        button { width: 100%; padding: 14px; background: #2a5298; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        button:hover { background: #1e3c72; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .result { margin-top: 24px; padding: 20px; background: #f0f7ff; border-radius: 8px; border-left: 4px solid #2a5298; display: none; }
        .result.show { display: block; }
        .error { background: #fff3f3; border-left-color: #d32f2f; color: #d32f2f; }
        .offer-card { background: white; padding: 16px; margin: 12px 0; border-radius: 8px; border: 1px solid #ddd; }
        .offer-card h3 { color: #2a5298; margin-bottom: 12px; }
        .offer-detail { display: flex; justify-content: space-between; margin: 8px 0; padding: 8px 0; border-bottom: 1px solid #eee; }
        .offer-detail:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∏ Comprar Criptomonedas</h1>
        <form id="form">
            <div class="form-group">
                <label>Tu moneda (Fiat)</label>
                <select id="fiat">
                    <option value="USD">USD - D√≥lar</option>
                    <option value="EUR">EUR - Euro</option>
                    <option value="GBP">GBP - Libra</option>
                </select>
            </div>
            <div class="form-group">
                <label>Quieres comprar</label>
                <select id="crypto">
                    <option value="USDT">USDT - Tether</option>
                    <option value="BTC">BTC - Bitcoin</option>
                    <option value="ETH">ETH - Ethereum</option>
                </select>
            </div>
            <div class="form-group">
                <label>Cantidad</label>
                <input type="number" id="amount" value="100" min="10" step="0.01" required>
            </div>
            <button type="submit" id="btn">Ver Ofertas</button>
        </form>
        <div id="result" class="result"></div>
    </div>
    <script>
        const API = 'https://changelly-backend.vercel.app/api/changelly';
        document.getElementById('form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn');
            const result = document.getElementById('result');
            btn.disabled = true;
            btn.textContent = 'Cargando...';
            result.className = 'result';
            try {
                const res = await fetch(API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fiatCurrency: document.getElementById('fiat').value,
                        cryptoCurrency: document.getElementById('crypto').value,
                        amount: document.getElementById('amount').value
                    })
                });
                const data = await res.json();
                if (data.offers && data.offers.length > 0) {
                    let html = '<h2>‚úÖ Ofertas Disponibles</h2>';
                    data.offers.forEach(offer => {
                        html += `<div class="offer-card">
                            <h3>${offer.providerName || 'Proveedor'}</h3>
                            <div class="offer-detail"><span>Recibes:</span><strong>${parseFloat(offer.amountTo).toFixed(6)} ${offer.currencyTo}</strong></div>
                            <div class="offer-detail"><span>Tasa:</span><strong>${(parseFloat(offer.amountTo) / parseFloat(offer.amountFrom)).toFixed(8)}</strong></div>
                        </div>`;
                    });
                    result.innerHTML = html;
                    result.className = 'result show';
                } else {
                    result.innerHTML = '<p>‚ö†Ô∏è No hay ofertas disponibles</p>';
                    result.className = 'result show error';
                }
            } catch (err) {
                result.innerHTML = `<p>‚ùå Error: ${err.message}</p>`;
                result.className = 'result show error';
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ver Ofertas';
            }
        });
    </script>
</body>
</html>
